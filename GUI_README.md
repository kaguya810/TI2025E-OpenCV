# PyQt5 GUI for TI2025E-OpenCV 控制系统

基于PyQt5的图形用户界面，为TI2025E-OpenCV舵机激光控制系统提供直观的操作界面。

## 功能特性

### 🖥️ 用户界面
- **实时视频显示**: 显示摄像头采集的实时画面，包含目标检测结果
- **参数调节面板**: 实时调整检测参数和PID控制参数
- **控制面板**: 启动/停止控制、激光开关、模式选择
- **状态监控**: 显示FPS、处理时间、连接状态等信息
- **日志显示**: 实时显示系统日志和调试信息

### 🎯 目标检测
- **黑色矩形检测**: 自动检测画面中的黑色矩形目标
- **参数实时调节**: 最小面积、矩形度、宽高比等参数可动态调整
- **可视化反馈**: 检测到的目标会实时标记在画面上

### 🎮 PID控制
- **双轴PID控制**: 分别控制水平(Pan)和垂直(Tilt)舵机
- **参数热更新**: PID参数可在运行时实时调整
- **输出显示**: 实时显示PID控制输出值

### 🔧 硬件控制
- **串口通信**: 支持Arduino等设备的串口控制
- **激光控制**: 激光开关控制和模式切换
- **舵机控制**: 通过PWM控制舵机运动

## 安装和使用

### 系统要求
- Python 3.6 或更高版本
- Linux 操作系统（推荐）
- 摄像头设备
- Arduino 或兼容设备（可选）

### 依赖安装
```bash
pip install PyQt5 opencv-python pyserial numpy python-periphery
```

### 快速启动
```bash
# 检查环境并启动GUI
python3 start_gui.py

# 或直接启动GUI
python3 gui_main.py

# 运行演示和测试
python3 gui_demo.py
```

## 界面说明

### 主窗口布局
```
┌─────────────────────────────────────────────────────┐
│                   TI2025E-OpenCV GUI               │
├─────────────────────────────┬───────────────────────┤
│                             │  检测参数 Detection  │
│       视频显示区域           │  ┌─ 最小面积          │
│     (实时摄像头画面)          │  ├─ 矩形度           │
│                             │  ├─ 最大宽高比        │
│                             │  └─ 高斯模糊          │
│                             ├───────────────────────┤
├─────────────────────────────┤  PID参数 PID Params  │
│                             │  ┌─ Pan: Kp/Ki/Kd    │
│       系统日志区域           │  └─ Tilt: Kp/Ki/Kd   │
│     (实时日志显示)           ├───────────────────────┤
│                             │  控制面板 Control     │
│                             │  ┌─ 开始/停止         │
│                             │  ├─ 激光控制          │
│                             │  ├─ 模式选择          │
│                             │  └─ 串口设置          │
│                             ├───────────────────────┤
│                             │  状态信息 Status      │
│                             │  ┌─ FPS              │
│                             │  ├─ 处理时间          │
│                             │  ├─ 控制状态          │
│                             │  ├─ 激光状态          │
│                             │  ├─ 串口状态          │
│                             │  └─ 目标检测          │
└─────────────────────────────┴───────────────────────┘
```

### 参数说明

#### 检测参数
- **最小面积**: 目标矩形的最小像素面积（建议5000-20000）
- **矩形度**: 目标的矩形程度阈值（0.1-1.0，越接近1越像矩形）
- **最大宽高比**: 目标的最大宽高比（1.0-10.0）
- **高斯模糊**: 图像预处理的模糊程度（奇数，1-15）

#### PID参数
- **Pan (水平轴)**:
  - Kp: 比例系数（建议0.1-5.0）
  - Ki: 积分系数（建议0.001-0.1）
  - Kd: 微分系数（建议0.001-0.1）
- **Tilt (垂直轴)**:
  - Kp: 比例系数（建议0.1-5.0）
  - Ki: 积分系数（建议0.001-0.1）
  - Kd: 微分系数（建议0.001-0.1）

## 操作流程

### 1. 系统启动
1. 连接摄像头和Arduino设备
2. 运行启动脚本：`python3 start_gui.py`
3. 检查硬件连接状态

### 2. 参数调节
1. 根据实际目标调整检测参数
2. 根据系统响应调整PID参数
3. 选择合适的串口端口

### 3. 开始控制
1. 点击"开始控制"按钮
2. 观察视频画面中的目标检测效果
3. 监控状态信息和系统日志

### 4. 激光控制
1. 确保串口连接正常
2. 使用激光开/关按钮控制激光
3. 选择不同的控制模式

## 故障排除

### 常见问题

#### 1. GUI无法启动
- 检查Python版本（需要3.6+）
- 安装缺少的依赖包
- 确保有图形界面环境

#### 2. 摄像头无法打开
- 检查摄像头连接
- 确认摄像头权限
- 尝试不同的摄像头ID（0, 1, 2...）

#### 3. 串口连接失败
- 检查设备连接
- 确认串口权限（可能需要sudo）
- 检查串口设备路径

#### 4. 目标检测效果差
- 调整检测参数（最小面积、矩形度等）
- 改善光照条件
- 确保目标与背景有足够对比度

#### 5. PID控制不稳定
- 降低Kp值
- 适当增加Kd值
- 检查机械系统是否有卡顿

### 调试技巧
1. 查看系统日志了解错误信息
2. 使用演示模式测试GUI功能
3. 逐步调整参数，观察效果变化
4. 检查硬件连接和权限设置

## 技术架构

### 核心组件
- **MainWindow**: 主窗口类，协调各个组件
- **CameraThread**: 摄像头采集线程
- **DetectionParamsWidget**: 检测参数控制面板
- **PIDParamsWidget**: PID参数控制面板
- **ControlWidget**: 主控制面板
- **StatusWidget**: 状态显示面板

### 数据流
```
摄像头 → CameraThread → 图像处理 → 目标检测 → PID控制 → 串口输出
    ↓                                            ↓
GUI显示 ← 状态更新 ← 参数调节 ← 用户交互 ← 控制面板
```

## 扩展开发

### 添加新功能
1. 在相应的Widget类中添加UI元素
2. 在MainWindow中处理业务逻辑
3. 更新信号连接和事件处理

### 自定义参数
1. 修改DetectionParams或PIDParams类
2. 更新对应的Widget控件
3. 确保参数同步和验证

## 许可证

本项目遵循与主项目相同的许可证。

## 贡献

欢迎提交Issues和Pull Requests来改进GUI功能。